function getCookie(e){var t=null;if(document.cookie&&""!=document.cookie)for(var o=document.cookie.split(";"),n=0;n<o.length;n++){var s=jQuery.trim(o[n]);if(s.substring(0,e.length+1)==e+"="){t=decodeURIComponent(s.substring(e.length+1));break}}return t}var csrftoken=getCookie("csrftoken");function csrfSafeMethod(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)}function sameOrigin(e){var t="//"+document.location.host,o=document.location.protocol+t;return e==o||e.slice(0,o.length+1)==o+"/"||e==t||e.slice(0,t.length+1)==t+"/"||!/^(\/\/|http:|https:).*/.test(e)}$(function(){$(document).on("click",".likes",function(){console.log("step1");var e=$(this).data("id"),t=$(this).data("type");$.ajax({url:"/"+t+"/"+e+"/like/",context:$(this),type:"POST",success:function(e){e&&($(this).siblings(".countlikes").text(e.likes),$(this).parents(".likesystem").find(".countdislikes").text(e.dislikes)),console.log(e)},error:function(e,t,o){console.log(e.status+": "+e.responseText),$("#exampleModalCenter").modal("show")}})}),$.ajaxSetup({beforeSend:function(e,t){!csrfSafeMethod(t.type)&&sameOrigin(t.url)&&e.setRequestHeader("X-CSRFToken",csrftoken)}})}),$(function(){$(document).on("click",".dislikes",function(){console.log("step1");var e=$(this).data("id"),t=$(this).data("type");$.ajax({url:"/"+t+"/"+e+"/dislike/",context:$(this),type:"POST",success:function(e){e&&($(this).parents(".likesystem").find(".countlikes").text(e.likes),$(this).siblings(".countdislikes").text(e.dislikes)),console.log(e)},error:function(e,t,o){console.log(e.status+": "+e.responseText),$("#exampleModalCenter").modal("show")}})}),$.ajaxSetup({beforeSend:function(e,t){!csrfSafeMethod(t.type)&&sameOrigin(t.url)&&e.setRequestHeader("X-CSRFToken",csrftoken)}})}),$(function(){$(document).on("click","#addcomment",function(e){e.preventDefault(),console.log("step1");var t=$("#addcomment").data("id"),o=$("#addcomment").data("type");$.ajax({url:"/"+o+"/"+t+"/comments/",type:"POST",data:{message:$("#id_message").val()},success:function(e){if(e){var t=$.parseHTML(e.new_comment);$("#comments_block").prepend(t),$("#comments_count").text(e.comments_count),$("#comments_count_str").text(e.comments_count),$("#id_message").val("")}console.log(e.comments_count)},error:function(e,t,o){console.log(e.status+": "+e.responseText),!0===JSON.parse(e.responseText).spam&&$("#spamModal").modal("show")}})}),$.ajaxSetup({beforeSend:function(e,t){!csrfSafeMethod(t.type)&&sameOrigin(t.url)&&e.setRequestHeader("X-CSRFToken",csrftoken)}})}),$(function(){$(document).on("click",".deletecomment",function(e){e.preventDefault(),console.log("step1");var t=$(this).data("id");$.ajax({url:"/comment/"+t+"/delete/",type:"POST",context:$(this),success:function(e){e&&($(this).parents(".comments")[0].remove(),$("#comments_count").text(e.comments_count),$("#comments_count_str").text(e.comments_count),$("#id_message").val("")),console.log(e)},error:function(e,t,o){console.log(e.status+": "+e.responseText)}})}),$.ajaxSetup({beforeSend:function(e,t){!csrfSafeMethod(t.type)&&sameOrigin(t.url)&&e.setRequestHeader("X-CSRFToken",csrftoken)}})}),$(function(){$(document).on("click",".updatecomment",function(e){e.preventDefault(),console.log("step1");var t=$(this).data("id"),o=$("#addcommentform").data("id");$("#closeaddcomment").show();var n=$(".commentmessage[data-id="+t+"]");$("#id_message").val($(n).text()).focus(),$("#addcomment").replaceWith('<button type="submit" class="btn-submit"  id="updatecomment" data-comment='+t+" data-id="+o+">Сохранить</button>"),$("#answercomment").replaceWith('<button type="submit" class="btn-submit"  id="updatecomment" data-comment='+t+" data-id="+o+">Сохранить</button>")})}),$(function(){$(document).on("click","#updatecomment",function(e){e.preventDefault(),console.log("step1");var s=$(this).data("comment"),a=$("#addcommentform").data("id");$.ajax({url:"/comment/"+s+"/update/",type:"POST",data:{message:$("#id_message").val()},context:s,post_id:function(e){if(e){var t=$(".comments[data-id="+s+"]"),o=$(".commentcreated[data-id="+s+"]"),n=$(".commentmessage[data-id="+s+"]");$(n).text(e.message).focus(),$(o).text(e.created+" | изменено"),$("#updatecomment").replaceWith("<button type='submit' class='btn-submit' id='addcomment' data-id="+a+">Отправить</button>"),$("#closeaddcomment").hide(),$("html,body").animate({scrollTop:$(t).offset().top-150},500),$("#id_message").val("")}console.log(e)},error:function(e,t,o){console.log(e.status+": "+e.responseText)}})}),$.ajaxSetup({beforeSend:function(e,t){!csrfSafeMethod(t.type)&&sameOrigin(t.url)&&e.setRequestHeader("X-CSRFToken",csrftoken)}})}),$(function(){$(document).on("click",".answercomment",function(e){e.preventDefault(),console.log("step1");var t=$(this).data("id"),o=$("#addcommentform").data("id"),n=$(".commentauthor[data-id="+t+"]").text();$("#closeaddcomment").show(),$("#id_message").val(n+", ").focus(),$("#addcomment").replaceWith('<button type="submit" class="btn-submit"  id="answercomment" data-comment='+t+" data-id="+o+">Ответить</button>"),$("#updatecomment").replaceWith('<button type="submit" class="btn-submit"  id="answercomment" data-comment='+t+" data-id="+o+">Ответить</button>")})}),$(function(){$(document).on("click","#closeaddcomment",function(e){e.preventDefault();var t=$("#addcommentform").data("id");$("#id_message").val("").focus(),$("#updatecomment").replaceWith("<button type='submit' class='btn-submit' id='addcomment' data-id="+t+">Отправить</button>"),$("#answercomment").replaceWith("<button type='submit' class='btn-submit' id='addcomment' data-id="+t+">Отправить</button>"),$("#closeaddcomment").hide()})}),$(function(){$(document).on("click","#answercomment",function(e){e.preventDefault(),console.log("step1");var n=$(this).data("comment"),s=$("#answercomment").data("id");$.ajax({url:"/comment/"+n+"/answer/",type:"POST",data:{message:$("#id_message").val()},context:n,success:function(e){var t=$.parseHTML(e.new_answer),o=$(".comments[data-id="+n+"]");1===e.status?$(o).parent().append(t):0===e.status&&$(o).find(".answers_block").append(t),$("#answercomment").replaceWith("<button type='submit' class='btn-submit' id='addcomment' data-id="+s+">Отправить</button>"),$("#comments_count").text(e.comments_count),$("#comments_count_str").text(e.comments_count),$("#closeaddcomment").hide(),$("html,body").animate({scrollTop:$(o).offset().top-150},500),console.log(e.status)},error:function(e,t,o){console.log(e.status+": "+e.responseText),!0===JSON.parse(e.responseText).spam&&$("#spamModal").modal("show")}})}),$.ajaxSetup({beforeSend:function(e,t){!csrfSafeMethod(t.type)&&sameOrigin(t.url)&&e.setRequestHeader("X-CSRFToken",csrftoken)}})}),$(function(){$(document).on("click","#update_avatar",function(e){e.preventDefault(),console.log("step1"),$.ajax({url:"/update_avatar/",type:"POST",success:function(e){e&&$("#avatar").attr("src",e.avatar_url),console.log(e)},error:function(e,t,o){console.log(e.status+": "+e.responseText)}})}),$.ajaxSetup({beforeSend:function(e,t){!csrfSafeMethod(t.type)&&sameOrigin(t.url)&&e.setRequestHeader("X-CSRFToken",csrftoken)}})}),$(function(){$(".subscribe").change(function(e){console.log("step1");var t=$(this).data("subs");$.ajax({url:"/profile/settings/"+t+"/",type:"POST",success:function(e){console.log(e)},error:function(e,t,o){console.log(e.status+": "+e.responseText),$("#exampleModalCenter").modal("show")}})}),$.ajaxSetup({beforeSend:function(e,t){!csrfSafeMethod(t.type)&&sameOrigin(t.url)&&e.setRequestHeader("X-CSRFToken",csrftoken)}})}),$(function(){$(document).on("click",".votes_yes",function(){console.log("step1");var t=$(this).data("id");$.ajax({url:"/questions/"+t+"/yes/",context:$(this),type:"POST",success:function(e){e&&($(this).find(".progress-bar").width(e.votes_yes+"%"),$(this).find(".progress-bar").attr("aria-valuenow",e.votes_yes),$(this).find(".vote-label").text("За "+e.votes_yes+"%"),$(".votes_no[data-id="+t+"]").find(".progress-bar").width(e.votes_no+"%"),$(".votes_no[data-id="+t+"]").find(".progress-bar").attr("aria-valuenow",e.votes_no),$(".votes_no[data-id="+t+"]").find(".vote-label").text("Против "+e.votes_no+"%"),$(".votes_count[data-id="+t+"]").text("Проголосовало "+e.total_votes)),console.log(e)},error:function(e,t,o){console.log(e.status+": "+e.responseText),$("#votesErrorModal").modal("show")}})}),$.ajaxSetup({beforeSend:function(e,t){!csrfSafeMethod(t.type)&&sameOrigin(t.url)&&e.setRequestHeader("X-CSRFToken",csrftoken)}})}),$(function(){$(document).on("click",".votes_no",function(){console.log("step1");var t=$(this).data("id");$.ajax({url:"/questions/"+t+"/no/",context:$(this),type:"POST",success:function(e){e&&($(this).find(".progress-bar").width(e.votes_no+"%"),$(this).find(".progress-bar").attr("aria-valuenow",e.votes_no),$(this).find(".vote-label").text("Против "+e.votes_no+"%"),$(".votes_yes[data-id="+t+"]").find(".progress-bar").width(e.votes_yes+"%"),$(".votes_yes[data-id="+t+"]").find(".progress-bar").attr("aria-valuenow",e.votes_yes),$(".votes_yes[data-id="+t+"]").find(".vote-label").text("За "+e.votes_yes+"%"),$(".votes_count[data-id="+t+"]").text("Проголосовало "+e.total_votes)),console.log(e)},error:function(e,t,o){console.log(e.status+": "+e.responseText),$("#votesErrorModal").modal("show")}})}),$.ajaxSetup({beforeSend:function(e,t){!csrfSafeMethod(t.type)&&sameOrigin(t.url)&&e.setRequestHeader("X-CSRFToken",csrftoken)}})});